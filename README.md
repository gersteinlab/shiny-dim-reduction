<!---
---
title: "Shiny Dimensionality Reduction"
pagetitle: Shiny Dimensionality Reduction
---
-->

# Shiny Dimensionality Reduction


##### Table of Contents  
[Overview](#overview)  
[Installing R](#installing-r)  
[Running App Code](#running-app-code)  
[Installing RStudio](#installing-rstudio)  
[Installing Rtools](#installing-rtools)  
[Installing Anaconda](#installing-anaconda)  
[Performing Reduction](#performing-reduction)  
[AWS Integration](#aws-integration)  
[Portable Executables](#portable-executables)  
[Running Tests](#running-tests)  

<a name="overview"/>

## Overview

This shiny dimensionality reduction (SDR) project applies dimensionality reduction methods to tabular data through workflows and generates R Shiny apps for interactive, precomputed visualization of the results. Supported analyses include:

* Principal Component Analysis (PCA)
* Variational Autoencoders (VAE)
* Uniform Manifold Approximation and Projection (UMAP)
* Potential of Heat diffusion for Affinity-based Transition Embedding (PHATE)
* t-Distributed Stochastic Neighbor Embedding (tSNE)
* Set Thresholding and Intersection with UpSetR

There are three ways to use this project:

* <b>Portable App:</b> If you received a portable Windows application generated by this project, no installations are necessary. To run the application, unzip the directory and run "run.bat".  
* <b>App Code:</b> If you possess source code for an application generated by this project, read the "Installing R" and "Running App Code" sections of this document.  
* <b>Reduction Workflow</b>: If you intend to perform dimensionality reduction with this project, please read the rest of this document before proceeding.  

Developed by Justin Chang under the mentorship of Joel Rozowsky and Mark Gerstein at the Gerstein Lab.

<a name="installing-r"/>

## Installing R

To run application source code or generate dimensionality reduction workflows, we recommend R >= 4.0.0.

You can download an installer for R from https://cran.r-project.org.  
For reproducibility, the following settings were used in development:  

* Run the installer as an administrator.  
* Keep the default installation location.  
* Select the 64-bit user installation.  
* Select customized startup, MDI, plain text help, no start menu folder.  
* Keep the defaults for additional tasks.

You can customize your home / library locations with the environmental variables "HOME", "R_LIBS_USER":

* <b>Windows:</b> Go to your environment variables ("env" in search) under "System Variables".
* <b>MacOS / Linux:</b> Edit your environment variables through your shell's ".bashrc" file.

<a name="running-app-code"/>

## Running App Code

Use R to navigate to the app directory and run the following code to set up the app:

```
source("install.R")
```

On subsequent uses, you can navigate to the app directory and run the following code to launch the app:

```
library(shiny)
runApp("app.R")
```

<a name="installing-rstudio"/>

## Installing RStudio

To generate dimensionality reduction workflows, we recommend RStudio >= 1.3.0.

You can download an installer for RStudio from https://rstudio.com/products/rstudio/download.  
For reproducibility, the following settings were used in development:  

* Run the installer as an administrator. Keep the default installation location.  
* Do not create start menu shortcuts. Do not allow automated crash reporting.  

<a name="installing-rtools"/>

## Installing Rtools

To generate dimensionality reduction workflows, we recommend Rtools >= Rtools40.

You can download an installer for Rtools40 from https://cran.r-project.org/bin/windows/Rtools.  
For reproducibility, the following settings were used in development:  

* Run the installer as an administrator. Keep the default installation location.  
* Save version history to registry and don't create start menu icons.  

To add Rtools to your PATH, add the following code to your .Renviron file:

```
PATH="${RTOOLS40_HOME}\usr\bin;${PATH}"
```

Restart R and run the following code to test functionality:

```
Sys.which("make")
```

<a name="installing-anaconda"/>

## Installing Anaconda

To generate dimensionality reduction workflows, a specialized environment in Anaconda (a Python package manager) is necessary. To install Anaconda, download an installer from https://anaconda.com, ensure RStudio is closed, and perform installation in a PATH without spaces, such as "C:/Anaconda".

Once Anaconda is installed, ensure that no existing environments are named "r-reticulate". You can do so through the following commands:

```
conda info --envs
conda env remove --name r-reticulate
```

Then set up r-reticulate in the Anaconda Command Prompt:  

```
conda create --name r-reticulate
conda activate r-reticulate
conda install tensorflow
pip install phate
```

<a name="performing-reduction"/>

## Performing Reduction

To generate dimensionality reduction workflows, please perform the following steps:

* Navigate to "File" -> "New Project..." -> "Version Control" -> "Git"
* Set the URL to https://github.com/gersteinlab/shiny-dim-reduction.git
* Name the Project Directory and select the parent directory.
* Press "Create Project" and wait for the project to open.
* To set up the workflow, open the project, open "install.R", and source the file. 

During installation, the following warning(s) can be safely ignored:  
```
Your CPU supports instructions that this TensorFlow binary was not compiled to use ...
```

<a name="aws-integration"/>

## AWS Integration

To create applications for visualizing workflow results, select a supported storage method:

* <b>Local Storage:</b> Store all generated data in a folder on a file system, usually named "reference". This is useful for portable executables, but may not be hostable through Shiny if the folder size is too large. 
* <b>AWS.S3:</b> Store all generated data in a bucket on AWS.S3. This substantially decreases app bundle size, but requires more setup. Although AWS offers a free plan, the onus is on the user to ensure that their AWS usage does not exceed their budget.

To upload data to AWS.S3, create an AWS.IAM account with full AWS.S3 permissions. The user should use the functions in "storage.R" to save a master key for that account in the project folder. This master account will upload data and its credentials should not be distributed with the generated app.

Generated apps should each be distributed with an AWS key (id, secret, S3 bucket) that link to an account with limited permissions. These permissions generally ought to include list / get / put, but the overall budget and permissions are in the hands of the developer. Please see example_aws_json.txt for an example policy.

<a name="portable-executables"/>

## Portable Executables

To create portable Windows executables, please follow the steps below:

* Create a folder that you intend to store the app in (portable folder).
* Install R-Portable and GoogleChromePortable into the portable folder.
* Add this line to R-Portable/App/R-Portable/etc/Rprofile.site: 
```
.First = function(){.libPaths(.Library)}
```
* Run R-Portable as an admin and check that the library location is portable with .libPaths(). 
* Copy the application directory, named "app", to the portable folder.
* Copy the local storage directory, named "reference", to the portable folder.
* Copy "runShinyApp.R" from the project directory to the portable folder.
* Copy "run.bat" from the project directory to the portable folder.
* Follow the instructions in "Running App Code" to install all necessary packages.

After these steps, the portable folder should have the following structure:

* R-Portable (folder)
* GoogleChromePortable (folder)
* app (folder)
* reference (folder)
* runShinyApp.R
* run.bat

<a name="running-tests"/>

## Running Tests

The tests folder contains scripts for testing various components of the project. Please feel free to share ideas for increasing test coverage.

We suggest running the tests in the following order:

1. test_install.R
2. test_plotting.R
3. test_authentication.R
4. test_find_replace.R
5. test_text_work.R
6. test_ui_functions.R
7. test_storage.R
8. test_preprocess.R
9. test_make_requests.R
10. test_workflows.R
11. test_sca_nor_fun.R
12. test_validation.R
13. test_red_methods.R
14. test_red_requests.R
